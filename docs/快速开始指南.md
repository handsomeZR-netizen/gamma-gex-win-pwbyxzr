# Gamma GEX Scalper - 快速开始指南

## 项目简介

这是一个基于 Gamma 暴露（GEX）的 0DTE（当日到期）期权交易系统，支持 SPX 和 NDX 指数。

**核心策略**：利用期权市场的 Gamma 暴露效应，价格会向 GEX Pin（最大 Gamma 暴露点）靠拢。

**性能数据**（1年回测，$25k 起始资金）：
- **NDX**: $290,076 最终余额，+1,060.3% ROI，87.6% 胜率 ⭐
- **SPX**: $110,551 最终余额，+342.2% ROI，90.8% 胜率

---

## 一、运行前准备

### 1. 系统要求

- **操作系统**: Linux (推荐 Ubuntu/Debian)
- **Python**: 3.8+
- **数据库**: SQLite3
- **网络**: 稳定的互联网连接（访问 Tradier API）

### 2. 必需的 API 密钥

你需要以下 API 密钥：

#### Tradier API（必需）
- **用途**: 获取实时行情、下单
- **注册**: https://tradier.com
- **需要两个账户**:
  - Sandbox 账户（模拟交易）
  - Live 账户（实盘交易）

#### Discord Webhook（可选，推荐）
- **用途**: 接收交易提醒
- **设置**: 在 Discord 服务器设置中创建 Webhook

#### Healthcheck.io（可选）
- **用途**: 监控系统运行状态
- **注册**: https://healthcheck.io

### 3. 安装依赖

```bash
cd gamma-gex-scalper-main

# 安装 Python 依赖
pip3 install -r requirements.txt

# 如果没有 requirements.txt，手动安装：
pip3 install yfinance pandas requests pytz
```

### 4. 配置环境变量

创建环境配置文件：

```bash
sudo nano /etc/gamma.env
```

添加以下内容（替换为你的实际密钥）：

```bash
# Tradier API 密钥
export TRADIER_SANDBOX_KEY="你的_Sandbox_密钥"
export TRADIER_LIVE_KEY="你的_Live_密钥"
export TRADIER_PAPER_ACCOUNT_ID="你的_Sandbox_账户ID"
export TRADIER_LIVE_ACCOUNT_ID="你的_Live_账户ID"

# Discord Webhook（可选）
export GAMMA_DISCORD_WEBHOOK_PAPER_URL="https://discord.com/api/webhooks/..."
export GAMMA_DISCORD_WEBHOOK_LIVE_URL="https://discord.com/api/webhooks/..."

# Healthcheck（可选）
export GAMMA_HEALTHCHECK_PAPER_URL="https://hc-ping.com/..."
export GAMMA_HEALTHCHECK_LIVE_URL="https://hc-ping.com/..."
```

加载环境变量：

```bash
source /etc/gamma.env
```

---

## 二、运行项目

### 1. 模拟交易（推荐先测试）

```bash
# SPX 模拟交易
python3 scalper.py SPX PAPER

# NDX 模拟交易（推荐，收益更高）
python3 scalper.py NDX PAPER
```

### 2. 实盘交易（确认模拟无误后）

```bash
# SPX 实盘
python3 scalper.py SPX LIVE

# NDX 实盘
python3 scalper.py NDX LIVE
```

### 3. 监控持仓

```bash
# 监控模拟持仓
python3 monitor.py PAPER

# 监控实盘持仓
python3 monitor.py LIVE
```

### 4. 命令行参数说明

```bash
python scalper.py <INDEX> [PAPER|LIVE] [pin_override] [price_override]
```

- `<INDEX>`: 必需，SPX 或 NDX
- `[PAPER|LIVE]`: 可选，默认 PAPER
- `[pin_override]`: 可选，覆盖 GEX Pin 价格（测试用）
- `[price_override]`: 可选，覆盖指数价格（测试用）

**示例**：
```bash
# 基本用法
python3 scalper.py SPX PAPER

# 带价格覆盖（测试）
python3 scalper.py NDX PAPER 21500 21480
```

---

## 三、自动化运行（Systemd）

### 1. 创建服务文件

**SPX 模拟交易服务**：
```bash
sudo nano /etc/systemd/system/gamma-scalper-spx-paper.service
```

内容：
```ini
[Unit]
Description=Gamma GEX Scalper - SPX Paper
After=network.target

[Service]
Type=oneshot
WorkingDirectory=/path/to/gamma-gex-scalper-main
ExecStart=/usr/bin/python3 scalper.py SPX PAPER
EnvironmentFile=/etc/gamma.env
User=root
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

**监控服务**：
```bash
sudo nano /etc/systemd/system/gamma-monitor-paper.service
```

内容：
```ini
[Unit]
Description=Gamma GEX Monitor - Paper
After=network.target

[Service]
Type=simple
WorkingDirectory=/path/to/gamma-gex-scalper-main
ExecStart=/usr/bin/python3 monitor.py PAPER
EnvironmentFile=/etc/gamma.env
Restart=always
RestartSec=10
User=root
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

### 2. 启用并启动服务

```bash
# 重新加载 systemd
sudo systemctl daemon-reload

# 启用服务（开机自启）
sudo systemctl enable gamma-monitor-paper.service

# 启动服务
sudo systemctl start gamma-monitor-paper.service

# 查看状态
sudo systemctl status gamma-monitor-paper.service

# 查看日志
journalctl -u gamma-monitor-paper -f
```

### 3. 定时任务（Cron）

编辑 crontab：
```bash
crontab -e
```

添加定时任务（每30分钟运行一次）：
```bash
# SPX 模拟交易 - 每30分钟
0,30 9-15 * * 1-5 cd /path/to/gamma-gex-scalper-main && source /etc/gamma.env && python3 scalper.py SPX PAPER >> /var/log/gamma-spx.log 2>&1

# NDX 模拟交易 - 每30分钟
0,30 9-15 * * 1-5 cd /path/to/gamma-gex-scalper-main && source /etc/gamma.env && python3 scalper.py NDX PAPER >> /var/log/gamma-ndx.log 2>&1
```

---

## 四、监控和日志

### 1. 查看交易日志

```bash
# 最近的交易
tail -20 data/trades.csv

# 实时监控日志
tail -f data/monitor_paper.log
```

### 2. 查看系统日志

```bash
# Systemd 服务日志
journalctl -u gamma-monitor-paper -f

# 查看最近50行
journalctl -u gamma-monitor-paper -n 50
```

### 3. 检查持仓

```bash
# 查看当前持仓
cat data/orders_paper.json | python3 -m json.tool
```

---

## 五、回测系统

### 1. 运行回测

```bash
# SPX 回测
python3 backtest_spx.py

# NDX 回测
python3 backtest_ndx.py

# 多指数对比
python3 backtest_multi_index.py
```

### 2. 生成报告

```bash
# 生成详细报告
python3 generate_backtest_report.py

# 查看报告
cat BACKTEST_REPORT_*.txt
```

---

## 六、常见问题

### 1. 401 错误（API 认证失败）

**原因**: API 密钥错误或未设置

**解决**:
```bash
# 检查环境变量
echo $TRADIER_SANDBOX_KEY
echo $TRADIER_LIVE_KEY

# 重新加载环境变量
source /etc/gamma.env
```

### 2. 没有交易信号

**可能原因**:
- VIX 太低（< 13）
- 不在交易时间（10:00-13:00 ET）
- RSI 超出范围（40-80）
- 市场波动太大

**检查**:
```bash
# 查看最近的日志
tail -50 data/monitor_paper.log | grep "SKIP"
```

### 3. 持仓未自动平仓

**检查监控服务**:
```bash
# 确认监控服务运行中
sudo systemctl status gamma-monitor-paper

# 查看监控日志
journalctl -u gamma-monitor-paper -n 100
```

---

## 七、性能优化建议

### 1. 推荐配置

- **首选指数**: NDX（收益是 SPX 的 3.1 倍）
- **资金分配**: 70% NDX + 30% SPX
- **交易时间**: 10:00-13:00 ET（最佳时段）
- **VIX 范围**: 13-20（最佳波动率）

### 2. 风险管理

- **止损**: 10%（自动执行）
- **止盈**: 50%（自动执行）
- **持有到期**: 80%+ 利润时持有到期（最大化收益）
- **每日最大持仓**: 3 个

### 3. 监控指标

- **胜率目标**: 40-50%
- **盈亏比**: 2:1 以上
- **最大回撤**: < 20%

---

## 八、下一步

1. ✅ **第1天**: 运行模拟交易，验证配置正确
2. ✅ **第1周**: 收集 10-15 笔交易，验证胜率 > 40%
3. ✅ **第2-3周**: 收集 30-50 笔交易，统计验证
4. ✅ **第4周**: 如果模拟表现良好，考虑小资金实盘

---

## 九、获取帮助

### 查看文档

```bash
# 主文档
cat README.md

# 部署验证
cat DEPLOYMENT_VALIDATION_2026_01_14.txt

# 回测报告
cat COMPREHENSIVE_BACKTEST_FINAL_REPORT.txt
```

### 常用命令

```bash
# 验证优化已激活
grep "CUTOFF_HOUR = 13\|VIX_FLOOR = 13" scalper.py

# 查看最近交易
tail -5 data/trades.csv

# 实时监控
watch -n 5 "tail -20 data/monitor_paper.log"
```

---

**创建日期**: 2026-02-06  
**状态**: 生产就绪  
**推荐**: 先运行模拟交易 1-2 周，验证无误后再实盘
